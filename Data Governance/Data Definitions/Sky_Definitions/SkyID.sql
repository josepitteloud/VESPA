/*###############################################################################
# Created on:   19/09/2012
# Created by:   Tony Kinnaird (TKD)
# Description:  Gives a user a process for defining the if an account has Anytime Plus
#
#################################################################################
# Dependencies
# ------------------------------------------------------------------------------
# (none)
#
#################################################################################
# Change log
# ------------------------------------------------------------------------------
# 19/09/2012  TKD   v01 - initial version
#
###############################################################################*/

-- ##############################################################################################################
-- ##### STEP 1.0 - Process									    #####
-- ##############################################################################################################

---------------------------------------------------------------------------------
--  Sky ID  [HH_HAS_SKYID]
---------------------------------------------------------------------------------
select sky.account_number
        ,dw_created_dt
        ,1 AS samprofileid
        ,rank() over (partition by sky.account_number order by dw_created_dt desc) as rank
into #sky_id
from sk_prod.sam_registrant as sky
         inner join VIQ_HH_ACCOUNT_TMP as Base
                    on sky.account_number = base.account_number
where sky.account_number is not null
group by sky.account_number, dw_created_dt, samprofileid;
commit;

delete from #sky_id where rank>1;
commit;




-- ##############################################################################################################
-- ##### STEP 1.0 Ended									    #####
-- ##############################################################################################################



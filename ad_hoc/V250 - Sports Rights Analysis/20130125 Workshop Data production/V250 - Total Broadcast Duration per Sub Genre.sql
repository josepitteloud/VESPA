

----EPG Total Content by sub_genre

---For EPG Data only Take SD Versions of Channels and 1 record per Region for Total Content--
drop table dbarnett.v250_epg_broadcast_total_by_sub_genre;
select sub_genre_description
,cast(broadcast_start_date_time_local as date) as broadcast_date
,sum(programme_instance_duration) as total_broadcast_seconds
,count(distinct cast(broadcast_start_date_time_local as date)) as broadcast_days
into dbarnett.v250_epg_broadcast_total_by_sub_genre
from sk_prod.Vespa_programme_schedule
where broadcast_start_date_time_local between '2012-11-01' and '2013-10-31' and genre_description = 'Sports' and service_key in (4523
,3615
,1758
,3150
,3022
,3027
,3023
,3028
,3515
,4402
,3255
,3411
,5416
,3209
,4401
,3406
,5087
,3638
,3107
,5353
,3825
,2330
,2303
,4151
,3813
,2402
,3210
,5071
,5068
,3580
,4753
,3806
,1354
,1355
,6753
,5703
,5708
,3645
,2156
,2006
,2012
,2018
,2075
,2011
,2072
,3544
,2061
,3208
,4100
,3719
,5905
,1873
,2611
,4205
,3260
,5530
,5609
,3417
,3653
,3625
,3627
,3752
,2552
,4077
,1371
,2020
,2019
,4610
,3617
,3352
,3211
,4547
,2202
,1626
,1830
,3403
,4102
,3505
,3407
,1757
,4420
,4541
,3815
,1448
,4130
,6273
,4505
,5610
,3611
,5337
,5602
,3714
,2510
,1813
,1872
,3410
,5741
,4215
,1825
,4034
,6233
,6231
,6232
,4115
,2306
,3012
,3830
,3632
,2401
,2407
,2408
,2403
,2406
,4548
,2405
,2409
,4071
,1881
,1887
,2522
,1884
,1843
,3777
,3609
,3618
,1370
,2612
,1360
,1628
,2302
,1151
,3141
,3639
,3221
,2142
,2121
,4604
,4004
,4009
,3101
,1627
,5165
,3781
,3590
,1357
,4560
,1305
,3010
,4407
,4110
,2304
,2308
,1874
,5706
,1875
,2619
,2301
,1894
,3001
,2413
,5740
,5900
,3916
,3641
,6240
,6260
,6272
,6391
,6532
,6533
,6534
,5707
,3354
,3359
,5761
,3357
,1853
,3386
,3656
,1858
,4262
,4216
,5070
,2609
,3732
,4089
,1877
,3682
,2603
,3541
,4007
,1879
,3340
,3735
,3708
,3516
,3831
,2501
,2508
,2509
,2507
,2516
,2506
,2521
,3508
,2512
,2503
,5715
,5285
,1834
,3731
,1847
,1806
,1821
,5521
,3616
,3147
,3356
,1857
,4340
,1846
,1849
,3510
,3914
,3409
,3800
,5500
,3258
,1832
,3750
,4263
,5311
,5952
,4350
,4201
,3415
,3646
,3000
,6761
,5907
,4105
,5915
,3636
,2325
,3412
,3915
,4001
,5608
,3353
,1251
,1252
,1256
,3213
,5701
,3631
,3630
,4409
,4210
,3601
,4551
,6758
,4933
,4015
,1001
,1752
,1753
,1412
,1812
,1002
,1818
,1816
,1808
,1815
,1811
,2201
,2203
,2207
,1838
,1404
,1409
,1807
,1701
,1301
,1302
,1333
,1322
,1306
,1314
,1402
,1833
,1430
,3215
,1350
,3709
,3358
,2601
,3613
,3612
,1772
,3608
,5300
,1771
,3603
,2711
,5712
,3408
,3206
,2505
,5605
,1372
,3811
,1253
,3805
,3547
,1802
,3525
,3935
,3780
,3812
,4644
,5607
,4266
,3643
,3751
,1255
,3351
,1805
,5882
,4410
,3251
,3104
,1842
,4360
,3720
,2502
,3531
,2511
,3108
,3810
,2617
,4550
,2305
,2608
,2607
,2606)
group by sub_genre_description
,broadcast_date
;
commit;

select * from dbarnett.v250_epg_broadcast_total_by_sub_genre


--select count(*) from  #missing_march_epg_data

select service_key
,broadcast_start_date_time_utc
into #missing_march_epg_data
from sk_prod.vespa_dp_prog_viewed_201303
where cast( broadcast_start_date_time_utc  as date) between '2012-03-03' and '2013-03-19' and genre_description = 'Sports' and service_key in (4523
,3615
,1758
,3150
,3022
,3027
,3023
,3028
,3515
,4402
,3255
,3411
,5416
,3209
,4401
,3406
,5087
,3638
,3107
,5353
,3825
,2330
,2303
,4151
,3813
,2402
,3210
,5071
,5068
,3580
,4753
,3806
,1354
,1355
,6753
,5703
,5708
,3645
,2156
,2006
,2012
,2018
,2075
,2011
,2072
,3544
,2061
,3208
,4100
,3719
,5905
,1873
,2611
,4205
,3260
,5530
,5609
,3417
,3653
,3625
,3627
,3752
,2552
,4077
,1371
,2020
,2019
,4610
,3617
,3352
,3211
,4547
,2202
,1626
,1830
,3403
,4102
,3505
,3407
,1757
,4420
,4541
,3815
,1448
,4130
,6273
,4505
,5610
,3611
,5337
,5602
,3714
,2510
,1813
,1872
,3410
,5741
,4215
,1825
,4034
,6233
,6231
,6232
,4115
,2306
,3012
,3830
,3632
,2401
,2407
,2408
,2403
,2406
,4548
,2405
,2409
,4071
,1881
,1887
,2522
,1884
,1843
,3777
,3609
,3618
,1370
,2612
,1360
,1628
,2302
,1151
,3141
,3639
,3221
,2142
,2121
,4604
,4004
,4009
,3101
,1627
,5165
,3781
,3590
,1357
,4560
,1305
,3010
,4407
,4110
,2304
,2308
,1874
,5706
,1875
,2619
,2301
,1894
,3001
,2413
,5740
,5900
,3916
,3641
,6240
,6260
,6272
,6391
,6532
,6533
,6534
,5707
,3354
,3359
,5761
,3357
,1853
,3386
,3656
,1858
,4262
,4216
,5070
,2609
,3732
,4089
,1877
,3682
,2603
,3541
,4007
,1879
,3340
,3735
,3708
,3516
,3831
,2501
,2508
,2509
,2507
,2516
,2506
,2521
,3508
,2512
,2503
,5715
,5285
,1834
,3731
,1847
,1806
,1821
,5521
,3616
,3147
,3356
,1857
,4340
,1846
,1849
,3510
,3914
,3409
,3800
,5500
,3258
,1832
,3750
,4263
,5311
,5952
,4350
,4201
,3415
,3646
,3000
,6761
,5907
,4105
,5915
,3636
,2325
,3412
,3915
,4001
,5608
,3353
,1251
,1252
,1256
,3213
,5701
,3631
,3630
,4409
,4210
,3601
,4551
,6758
,4933
,4015
,1001
,1752
,1753
,1412
,1812
,1002
,1818
,1816
,1808
,1815
,1811
,2201
,2203
,2207
,1838
,1404
,1409
,1807
,1701
,1301
,1302
,1333
,1322
,1306
,1314
,1402
,1833
,1430
,3215
,1350
,3709
,3358
,2601
,3613
,3612
,1772
,3608
,5300
,1771
,3603
,2711
,5712
,3408
,3206
,2505
,5605
,1372
,3811
,1253
,3805
,3547
,1802
,3525
,3935
,3780
,3812
,4644
,5607
,4266
,3643
,3751
,1255
,3351
,1805
,5882
,4410
,3251
,3104
,1842
,4360
,3720
,2502
,3531
,2511
,3108
,3810
,2617
,4550
,2305
,2608
,2607
,2606

)
;




/*

select genre_description
,sub_genre_description
,service_key
, sum(case when vw.capped_partial_flag = 1 then datediff(second, vw.instance_start_date_time_utc, vw.capping_end_date_time_utc)
     else datediff(second, vw.instance_start_date_time_utc, vw.instance_end_date_time_utc)
     end)  as instance_duration_v2

from sk_prod.vespa_dp_prog_viewed_201303 as vw
where  
--capping_end_date_time_utc >instance_start_date_time_utc
--and 
panel_id = 12  and capped_full_flag = 0
and instance_start_date_time_utc < instance_end_date_time_utc   

group by genre_description
,sub_genre_description
,service_key
;
commit;
*/